import{d as F,B as z,C as _,a as v,b,A as P,s as w,r as $,p as x,o as r,h as d,q as y,D,E,i as e,t as c,j as I,v as O,x as l,m,k as h,F as g,n as k,y as S,z as U,G as N}from"./index-86f5a28a.js";const C="/user",L=F({id:"profile",state:()=>({peers:[],stats:{},statsEnabled:!1,user:{},filter:"",pageSize:10,pageOffset:0,pages:[],fetching:!1}),getters:{FindPeers:t=>a=>t.peers.find(i=>i.Identifier===a),CountPeers:t=>t.peers.length,FilteredPeerCount:t=>t.FilteredPeers.length,Peers:t=>t.peers,FilteredPeers:t=>t.filter?t.peers.filter(a=>a.DisplayName.includes(t.filter)||a.Identifier.includes(t.filter)):t.peers,FilteredAndPagedPeers:t=>t.FilteredPeers.slice(t.pageOffset,t.pageOffset+t.pageSize),isFetching:t=>t.fetching,hasNextPage:t=>t.pageOffset<t.FilteredPeerCount-t.pageSize,hasPrevPage:t=>t.pageOffset>0,currentPage:t=>t.pageOffset/t.pageSize+1,Statistics:t=>a=>t.statsEnabled&&a in t.stats?t.stats[a]:z(),hasStatistics:t=>t.statsEnabled},actions:{afterPageSizeChange(){this.pageOffset=0,this.calculatePages()},calculatePages(){let t=1;this.pages=[];for(let a=0;a<this.FilteredPeerCount;a+=this.pageSize)this.pages.push(t++)},gotoPage(t){this.pageOffset=(t-1)*this.pageSize,this.calculatePages()},nextPage(){this.pageOffset+=this.pageSize,this.calculatePages()},previousPage(){this.pageOffset-=this.pageSize,this.calculatePages()},setPeers(t){this.peers=t,this.fetching=!1},setUser(t){this.user=t,this.fetching=!1},setStats(t){t||(this.stats={},this.statsEnabled=!1),this.stats=t.Stats,this.statsEnabled=t.Enabled},async LoadPeers(){this.fetching=!0;let t=_().user.Identifier;return v.get(`${C}/${b(t)}/peers`).then(this.setPeers).catch(a=>{this.setPeers([]),console.log("Failed to load user peers for ",t,": ",a),P({title:"Backend Connection Failure",text:"Failed to load user peers!"})})},async LoadStats(){this.fetching=!0;let t=_().user.Identifier;return v.get(`${C}/${b(t)}/stats`).then(this.setStats).catch(a=>{this.setStats(void 0),console.log("Failed to load peer stats: ",a),P({title:"Backend Connection Failure",text:"Failed to load peer stats!"})})},async LoadUser(){this.fetching=!0;let t=_().user.Identifier;return v.get(`${C}/${b(t)}`).then(this.setUser).catch(a=>{this.setUser({}),console.log("Failed to load user for ",t,": ",a),P({title:"Backend Connection Failure",text:"Failed to load user!"})})}}}),B={class:"mt-4 row"},V={class:"col-12 col-lg-5"},A={class:"mt-2"},M={class:"col-12 col-lg-4 text-lg-end"},T={class:"form-group d-inline"},W={class:"input-group mb-3"},j=["placeholder"],q=["title"],G=e("i",{class:"fa-solid fa-search"},null,-1),H=[G],K={class:"col-12 col-lg-3 text-lg-end"},J=["title"],Q=e("i",{class:"fa fa-plus me-1"},null,-1),X=e("i",{class:"fa fa-user"},null,-1),Y=[Q,X],Z={class:"mt-2 table-responsive"},R={key:0},ee={key:1,id:"peerTable",class:"table table-sm"},te={scope:"col"},se=["title"],ie=e("th",{scope:"col"},null,-1),le={scope:"col"},ae={scope:"col"},oe={key:0,scope:"col"},ne={scope:"col"},re=e("th",{scope:"col"},null,-1),de=e("th",{scope:"row"},[e("input",{id:"flexCheckDefault",class:"form-check-input",type:"checkbox",value:""})],-1),ce={class:"text-center"},he={key:0,class:"text-danger"},ue=["title"],fe={key:1,class:"text-warning"},pe=["title"],ge=["title"],_e=["title"],ve={key:0},be={key:0},Pe=e("span",{class:"badge rounded-pill bg-success"},[e("i",{class:"fa-solid fa-link"})],-1),me=["title"],ke={key:1},Se=e("span",{class:"badge rounded-pill bg-light"},[e("i",{class:"fa-solid fa-link-slash"})],-1),Ce=[Se],$e={class:"text-center"},ye=["title","onClick"],Ie=e("i",{class:"fas fa-eye me-2"},null,-1),Fe=[Ie],ze=["title","onClick"],we=e("i",{class:"fas fa-cog"},null,-1),xe=[we],De=e("hr",null,null,-1),Ee={class:"mt-3"},Oe={class:"row"},Ue={class:"col-6"},Ne={class:"pagination pagination-sm"},Le=["onClick"],Be={class:"col-6"},Ve={class:"form-group row"},Ae={class:"col-sm-6 col-form-label text-end",for:"paginationSelector"},Me={class:"col-sm-6"},Te=e("option",{value:"10"},"10",-1),We=e("option",{value:"25"},"25",-1),je=e("option",{value:"50"},"50",-1),qe=e("option",{value:"100"},"100",-1),Ge={value:"999999999"},Ke={__name:"ProfileView",setup(t){const a=w(),i=L(),p=$(""),u=$("");return x(async()=>{await i.LoadUser(),await i.LoadPeers(),await i.LoadStats()}),(o,n)=>(r(),d(g,null,[y(D,{peerId:p.value,visible:p.value!=="",onClose:n[0]||(n[0]=s=>p.value="")},null,8,["peerId","visible"]),y(E,{peerId:u.value,visible:u.value!=="",onClose:n[1]||(n[1]=s=>u.value="")},null,8,["peerId","visible"]),e("div",B,[e("div",V,[e("h2",A,c(o.$t("profile.headline")),1)]),e("div",M,[e("div",T,[e("div",W,[I(e("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>l(i).filter=s),class:"form-control",placeholder:o.$t("general.search.placeholder"),type:"text",onKeyup:n[3]||(n[3]=(...s)=>l(i).afterPageSizeChange&&l(i).afterPageSizeChange(...s))},null,40,j),[[O,l(i).filter]]),e("button",{class:"input-group-text btn btn-primary",title:o.$t("general.search.button")},H,8,q)])])]),e("div",K,[l(a).Setting("SelfProvisioning")?(r(),d("a",{key:0,class:"btn btn-primary ms-2",href:"#",title:o.$t("general.search.button-add-peer"),onClick:n[4]||(n[4]=m(s=>u.value="#NEW#",["prevent"]))},Y,8,J)):h("",!0)])]),e("div",Z,[l(i).CountPeers===0?(r(),d("div",R,[e("h4",null,c(o.$t("profile.no-peer.headline")),1),e("p",null,c(o.$t("profile.no-peer.abstract")),1)])):h("",!0),l(i).CountPeers!==0?(r(),d("table",ee,[e("thead",null,[e("tr",null,[e("th",te,[e("input",{id:"flexCheckDefault",class:"form-check-input",title:o.$t("general.select-all"),type:"checkbox",value:""},null,8,se)]),ie,e("th",le,c(o.$t("profile.table-heading.name")),1),e("th",ae,c(o.$t("profile.table-heading.ip")),1),l(i).hasStatistics?(r(),d("th",oe,c(o.$t("profile.table-heading.stats")),1)):h("",!0),e("th",ne,c(o.$t("profile.table-heading.interface")),1),re])]),e("tbody",null,[(r(!0),d(g,null,k(l(i).FilteredAndPagedPeers,s=>(r(),d("tr",{key:s.Identifier},[de,e("td",ce,[s.Disabled?(r(),d("span",he,[e("i",{class:"fa fa-circle-xmark",title:s.DisabledReason},null,8,ue)])):h("",!0),!s.Disabled&&s.ExpiresAt?(r(),d("span",fe,[e("i",{class:"fas fa-hourglass-end",title:s.ExpiresAt},null,8,pe)])):h("",!0)]),e("td",null,[s.DisplayName?(r(),d("span",{key:0,title:s.Identifier},c(s.DisplayName),9,ge)):(r(),d("span",{key:1,title:s.Identifier},c(o.$filters.truncate(s.Identifier,10)),9,_e))]),e("td",null,[(r(!0),d(g,null,k(s.Addresses,f=>(r(),d("span",{key:f,class:"badge rounded-pill bg-light"},c(f),1))),128))]),l(i).hasStatistics?(r(),d("td",ve,[l(i).Statistics(s.Identifier).IsConnected?(r(),d("div",be,[Pe,N(),e("span",{title:o.peers.Statistics(s.Identifier).LastHandshake},c(o.$t("profile.peer-connected")),9,me)])):(r(),d("div",ke,Ce))])):h("",!0),e("td",null,c(s.InterfaceIdentifier),1),e("td",$e,[e("a",{href:"#",title:o.$t("profile.button-show-peer"),onClick:m(f=>p.value=s.Identifier,["prevent"])},Fe,8,ye),e("a",{href:"#",title:o.$t("profile.button-edit-peer"),onClick:m(f=>u.value=s.Identifier,["prevent"])},xe,8,ze)])]))),128))])])):h("",!0)]),De,e("div",Ee,[e("div",Oe,[e("div",Ue,[e("ul",Ne,[e("li",{class:S([{disabled:l(i).pageOffset===0},"page-item"])},[e("a",{class:"page-link",onClick:n[5]||(n[5]=(...s)=>l(i).previousPage&&l(i).previousPage(...s))},"«")],2),(r(!0),d(g,null,k(l(i).pages,s=>(r(),d("li",{key:s,class:S([{active:l(i).currentPage===s},"page-item"])},[e("a",{class:"page-link",onClick:f=>l(i).gotoPage(s)},c(s),9,Le)],2))),128)),e("li",{class:S([{disabled:!l(i).hasNextPage},"page-item"])},[e("a",{class:"page-link",onClick:n[6]||(n[6]=(...s)=>l(i).nextPage&&l(i).nextPage(...s))},"»")],2)])]),e("div",Be,[e("div",Ve,[e("label",Ae,c(o.$t("general.pagination.size"))+":",1),e("div",Me,[I(e("select",{"onUpdate:modelValue":n[7]||(n[7]=s=>l(i).pageSize=s),class:"form-select",onClick:n[8]||(n[8]=s=>l(i).afterPageSizeChange())},[Te,We,je,qe,e("option",Ge,c(o.$t("general.pagination.all")),1)],512),[[U,l(i).pageSize,void 0,{number:!0}]])])])])])])],64))}};export{Ke as default};
